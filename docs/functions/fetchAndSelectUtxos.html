<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>fetchAndSelectUtxos | midnight-drop-fireblocks-sdk</title><meta name="description" content="Documentation for midnight-drop-fireblocks-sdk"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">midnight-drop-fireblocks-sdk</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">fetchAndSelectUtxos</a></li></ul><h1>Function fetchAndSelectUtxos</h1></div><section class="tsd-panel"><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="fetchandselectutxos"><span class="tsd-kind-call-signature">fetchAndSelectUtxos</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">address</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">blockfrostProjectId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">tokenPolicyId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">requiredTokenAmount</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transactionFee</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">minRecipientLovelace</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">minChangeLovelace</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><br/>    <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">accumulatedAda</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">accumulatedTokenAmount</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">blockfrost</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">BlockFrostAPI</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">selectedUtxos</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/Utxo.html" class="tsd-signature-type tsd-kind-interface">Utxo</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><a href="#fetchandselectutxos" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Fetches and selects UTXOs sufficient for a token transfer with fees and minimum ADA requirements.</p>
<p>This function implements intelligent UTXO selection for Cardano transactions involving native tokens.
It uses a two-phase selection strategy:</p>
<ol>
<li>Selects UTXOs containing the target token, sorted by token amount (largest first)</li>
<li>If additional ADA is needed for fees and minimum outputs, selects pure ADA UTXOs</li>
</ol>
<p>The selection ensures sufficient funds for:</p>
<ul>
<li>Required token amount for transfer</li>
<li>Recipient output minimum ADA (default 1.2 ADA)</li>
<li>Transaction fees</li>
<li>Change output minimum ADA (default 1.2 ADA)</li>
</ul>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">address</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The Cardano address to fetch UTXOs from (Bech32 format, e.g., addr1...)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">blockfrostProjectId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Blockfrost API project ID for authentication</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">tokenPolicyId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The policy ID of the native token to transfer (hex string)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">requiredTokenAmount</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Minimum token amount required for the transfer</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">transactionFee</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Estimated transaction fee in lovelace (typically 170,000-300,000)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">minRecipientLovelace</span>: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1_200_000</span></span><div class="tsd-comment tsd-typography"><p>Minimum ADA required for recipient output (default: 1,200,000 lovelace = 1.2 ADA)</p>
</div><div class="tsd-comment tsd-typography"></div></li><li><span><span class="tsd-kind-parameter">minChangeLovelace</span>: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1_200_000</span></span><div class="tsd-comment tsd-typography"><p>Minimum ADA required for change output (default: 1,200,000 lovelace = 1.2 ADA)</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><br/>    <span class="tsd-signature-symbol">{</span><br/>        <span class="tsd-kind-property">accumulatedAda</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">accumulatedTokenAmount</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">blockfrost</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">BlockFrostAPI</span><span class="tsd-signature-symbol">;</span><br/>        <span class="tsd-kind-property">selectedUtxos</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/Utxo.html" class="tsd-signature-type tsd-kind-interface">Utxo</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">;</span><br/>    <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span></h4><p>A Promise resolving to an object containing:</p>
<ul>
<li>blockfrost: Initialized BlockFrostAPI instance for subsequent operations</li>
<li>selectedUtxos: Array of selected UTXOs sufficient for the transaction</li>
<li>accumulatedAda: Total ADA amount in selected UTXOs (lovelace)</li>
<li>accumulatedTokenAmount: Total token amount in selected UTXOs</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws">Throws<a href="#throws" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When fetching UTXOs from Blockfrost fails</p>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-1">Throws<a href="#throws-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When no UTXOs contain the specified token</p>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-2">Throws<a href="#throws-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When insufficient UTXOs to meet ADA or token requirements</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example">Example<a href="#example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-3">// Select UTXOs for transferring 1000 NIGHT tokens</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">result</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">fetchAndSelectUtxos</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;addr1qx2kd88w9p6m7c8xc6qzn2g3vxy9wjsa9fkw32ylm9z8r3qp4c5tc&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;mainnetABC123...&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;abc123...&#39;</span><span class="hl-1">, </span><span class="hl-3">// NIGHT token policy ID</span><br/><span class="hl-1">  </span><span class="hl-9">1000</span><span class="hl-1">,        </span><span class="hl-3">// Transfer 1000 tokens</span><br/><span class="hl-1">  </span><span class="hl-9">200000</span><span class="hl-1">,      </span><span class="hl-3">// 0.2 ADA fee estimate</span><br/><span class="hl-1">  </span><span class="hl-9">1500000</span><span class="hl-1">,     </span><span class="hl-3">// 1.5 ADA min for recipient</span><br/><span class="hl-1">  </span><span class="hl-9">1200000</span><span class="hl-1">      </span><span class="hl-3">// 1.2 ADA min for change</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Selected </span><span class="hl-5">${</span><span class="hl-4">result</span><span class="hl-14">.</span><span class="hl-4">selectedUtxos</span><span class="hl-14">.</span><span class="hl-4">length</span><span class="hl-5">}</span><span class="hl-2"> UTXOs`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total ADA: </span><span class="hl-5">${</span><span class="hl-4">result</span><span class="hl-14">.</span><span class="hl-4">accumulatedAda</span><span class="hl-14"> </span><span class="hl-1">/</span><span class="hl-14"> </span><span class="hl-9">1_000_000</span><span class="hl-5">}</span><span class="hl-2"> ADA`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Total tokens: </span><span class="hl-5">${</span><span class="hl-4">result</span><span class="hl-14">.</span><span class="hl-4">accumulatedTokenAmount</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Use results for transaction building</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">inputs</span><span class="hl-1"> = </span><span class="hl-0">createTransactionInputs</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">selectedUtxos</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">outputs</span><span class="hl-1"> = </span><span class="hl-0">createTransactionOutputs</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-9">1500000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">200000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">recipientAddress</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">selectedUtxos</span><span class="hl-1">[</span><span class="hl-9">0</span><span class="hl-1">].</span><span class="hl-4">address</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">tokenPolicyId</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&#39;NIGHT&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">1000</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">selectedUtxos</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">// Basic usage with defaults</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-8">blockfrost</span><span class="hl-1">, </span><span class="hl-8">selectedUtxos</span><span class="hl-1">, </span><span class="hl-8">accumulatedAda</span><span class="hl-1">, </span><span class="hl-8">accumulatedTokenAmount</span><span class="hl-1"> } =</span><br/><span class="hl-1">  </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-0">fetchAndSelectUtxos</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">address</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">blockfrostProjectId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tokenPolicyId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">1000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-9">200000</span><br/><span class="hl-1">  );</span><br/><br/><span class="hl-3">// Check if selection was successful</span><br/><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">accumulatedTokenAmount</span><span class="hl-1"> &lt; </span><span class="hl-9">1000</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Insufficient token balance&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">accumulatedAda</span><span class="hl-1"> &lt; </span><span class="hl-9">1500000</span><span class="hl-1"> + </span><span class="hl-9">200000</span><span class="hl-1"> + </span><span class="hl-9">1200000</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Insufficient ADA for fees and minimums&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks">Remarks<a href="#remarks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The function prioritizes UTXOs with the most tokens to minimize the number of inputs,
which helps reduce transaction size and fees.</p>
<p>Cardano requires minimum ADA amounts in all UTXOs containing native tokens. The default
1.2 ADA minimum is safe for most tokens, but complex tokens with long names or many
different tokens in one UTXO may require higher minimums.</p>
<p>Transaction fees vary based on transaction size (number of inputs/outputs). A typical
token transfer uses 170,000-300,000 lovelace. For precise fees, build the transaction
first and use the calculated fee from Lucid.</p>
<p>The returned BlockFrostAPI instance can be reused for other operations in the same
transaction flow (e.g., fetching latest block, submitting transaction).</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/fireblocks/midnight-glacier-drop-sdk/blob/ea74eab342873e998a52b31619528b11b4392f7f/src/utils/cardano.utils.ts#L110">src/utils/cardano.utils.ts:110</a></li></ul></aside></div></li></ul></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">midnight-drop-fireblocks-sdk</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
